<!DOCTYPE html>
<html lang="zh">
<head>
<!-- ç½‘é¡µæ ‡é¢˜ -->
<meta name="apple-mobile-web-app-title" content="æ³°é“¢è®°è´¦">
<!-- å¯ç”¨å…¨å±æ¨¡å¼ -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- iOS å›¾æ ‡ -->
<link rel="apple-touch-icon" href="icon.png">

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ³°é“¢æ¯æ—¥è®°è´¦</title>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont;
  background: #f2f2f7;
  margin: 0;
  padding: 16px;
}
h2 { margin: 18px 0 8px; }
.card {
  background: #fff;
  border-radius: 14px;
  padding: 14px;
  margin-bottom: 14px;
}
input, button {
  width: 100%;
  padding: 10px;
  margin-top: 8px;
  font-size: 16px;
}
button {
  background: #007aff;
  color: #fff;
  border: none;
  border-radius: 10px;
}
button.secondary {
  background: #34c759;
}
.record-wrap {
  position: relative;
  overflow: hidden;
}
.delete-btn {
  position: absolute;
  right: 0;
  top: 0;
  bottom: 0;
  width: 80px;
  background: #ff3b30;
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
}
.record {
  background: #fff;
  padding: 10px;
  border-bottom: 1px solid #eee;
  transition: transform 0.2s;
}
.small {
  font-size: 13px;
  color: #888;
}
.negative {
  color: #ff3b30;
}
</style>
</head>

<body>

<h2>ğŸ“Š æœ¬æœˆæ¦‚è§ˆ</h2>
<div class="card" id="monthStat"></div>

<h2>ğŸ“ è®°ä¸€ç¬”</h2>
<div class="card">
  <input type="number" id="amount" placeholder="é‡‘é¢ï¼ˆà¸¿ï¼‰">
  <input type="text" id="note" placeholder="å¤‡æ³¨">
  <button onclick="addExpense()">æäº¤</button>
</div>

<h2>ğŸ“… ä»Šæ—¥è®°å½•</h2>
<div class="card" id="todayList"></div>

<h2>ğŸ” æŸ¥è¯¢æŸå¤©</h2>
<div class="card">
  <input type="date" id="queryDate">
  <button class="secondary" onclick="queryByDate()">æŸ¥è¯¢</button>
  <div id="queryResult"></div>
</div>

<script>
const DAILY = 500;

// ---------- å·¥å…· ----------
function today() {
  return new Date().toISOString().slice(0,10);
}
function monthKey(d = new Date()) {
  return d.toISOString().slice(0,7);
}
function load() {
  return JSON.parse(localStorage.getItem("expenses") || "[]");
}
function save(d) {
  localStorage.setItem("expenses", JSON.stringify(d));
}

// ---------- æœ¬æœˆè®¡ç®— ----------
function monthStats() {
  const now = new Date();
  const start = new Date(now.getFullYear(), now.getMonth(), 1);
  const days = Math.floor((now - start) / 86400000) + 1;
  const expenses = load().filter(e => e.month === monthKey());
  const used = expenses.reduce((s,e)=>s+e.amount,0);
  const quota = days * DAILY;
  return { quota, used, remain: quota - used };
}

// ---------- æ¸²æŸ“æœ¬æœˆ ----------
function renderMonth() {
  const m = monthStats();
  document.getElementById("monthStat").innerHTML = `
    <div>æœ¬æœˆé¢åº¦ï¼šà¸¿${m.quota}</div>
    <div>å·²æ¶ˆè´¹ï¼šà¸¿${m.used}</div>
    <div class="${m.remain<0?'negative':''}">
      å‰©ä½™ï¼šà¸¿${m.remain}
    </div>
  `;
}

// ---------- ä»Šæ—¥ ----------
function renderToday() {
  const box = document.getElementById("todayList");
  const list = load().filter(e => e.date === today());
  box.innerHTML = "";

  if (!list.length) {
    box.innerHTML = "<div class='small'>ä»Šå¤©è¿˜æ²¡æœ‰è®°å½•</div>";
    return;
  }

  list.forEach(e => {
    const wrap = document.createElement("div");
    wrap.className = "record-wrap";

    const del = document.createElement("div");
    del.className = "delete-btn";
    del.innerText = "åˆ é™¤";
    del.onclick = () => deleteExpense(e.id);

    const rec = document.createElement("div");
    rec.className = "record";
    rec.innerHTML = `à¸¿${e.amount} - ${e.note}
      <div class="small">${e.time}</div>`;

    let startX = 0;
    rec.addEventListener("touchstart", t => startX = t.touches[0].clientX);
    rec.addEventListener("touchmove", t => {
      const dx = t.touches[0].clientX - startX;
      if (dx < -30) rec.style.transform = "translateX(-80px)";
      if (dx > 30) rec.style.transform = "translateX(0)";
    });

    wrap.appendChild(del);
    wrap.appendChild(rec);
    box.appendChild(wrap);
  });
}

// ---------- è®°è´¦ ----------
const amountInput = document.getElementById("amount");
const note = document.getElementById("note");

function addExpense() {
  const amount = Number(amountInput.value);
  if (!amount || amount <= 0) return alert("è¯·è¾“å…¥æ­£ç¡®é‡‘é¢");

  const now = new Date();
  const data = load();
  data.push({
    id: Date.now(),
    amount,
    note: note.value,
    date: today(),
    month: monthKey(),
    time: now.toTimeString().slice(0,5)
  });
  save(data);

  amountInput.value = "";
  note.value = "";

  renderAll();
}

// ---------- åˆ é™¤ ----------
function deleteExpense(id) {
  save(load().filter(e => e.id !== id));
  renderAll();
}

// ---------- æŸ¥è¯¢ ----------
function queryByDate() {
  const date = document.getElementById("queryDate").value;
  if (!date) return;

  const expenses = load().filter(e => e.date === date);
  const total = expenses.reduce((s,e)=>s+e.amount,0);

  const box = document.getElementById("queryResult");
  box.innerHTML = `<div class="stat"><strong>æ€»æ¶ˆè´¹</strong>: à¸¿${total}</div>`;

  expenses.forEach(e => {
    const div = document.createElement("div");
    div.className = "record";
    div.innerHTML = `à¸¿${e.amount} - ${e.note}
      <div class="small">${e.time}</div>`;
    box.appendChild(div);
  });
}

// ---------- æ€»åˆ·æ–° ----------
function renderAll() {
  renderMonth();
  renderToday();
}

renderAll();
</script>

</body>
</html>
